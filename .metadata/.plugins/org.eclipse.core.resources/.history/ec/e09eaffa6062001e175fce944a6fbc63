package controller.gerente;

import javafx.fxml.FXML;
import javafx.scene.control.Label;
import javafx.scene.control.TextField;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.input.MouseEvent;
import javafx.stage.FileChooser;
import javafx.stage.Stage;
import javafx.stage.FileChooser.ExtensionFilter;
import model.Funcionario;
import model.dao.ConexãoBD;
import model.dao.Gerente.TelaDePerfilDao;
import model.dao.login.MainModel;

import java.io.File;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.util.List;

import controller.Main;
import controller.Ferramentas.EfeitoBtn;

public class TelaDePerfilController {

	EfeitoBtn efeito = new EfeitoBtn();

    @FXML
    private ImageView BtnEncerrarSessao;

    @FXML
    private TextField TxtBairro;

    @FXML
    private TextField TxtCPF;

    @FXML
    private TextField TxtCep;

    @FXML
    private TextField TxtCidade;

    @FXML
    private TextField TxtDataNascimento;

    @FXML
    private TextField TxtEmail;

    @FXML
    private TextField TxtLongradouro;

    @FXML
    private TextField TxtNome;

    @FXML
    private TextField TxtSenha;

    @FXML
    private TextField TxtTelefone;

    @FXML
    private ImageView imgFoto;

    @FXML
    private Label lblTrocarFoto;

 
    @FXML
    private void initialize() throws SQLException {
        int idFuncionario = MainModel.verificaID();
        List<Funcionario> funcionarios = TelaDePerfilDao.getFuncionarioComEndereco(idFuncionario);

        if (!funcionarios.isEmpty()) {
            Funcionario funcionario = funcionarios.get(0); // Supondo que você obtenha apenas um funcionário

            TxtNome.setText(funcionario.getNomeCompleto());
            TxtCPF.setText(funcionario.getCpf());
            TxtDataNascimento.setText(funcionario.getDataNascimento().toString());
            TxtTelefone.setText(funcionario.getTelefone());
            TxtEmail.setText(funcionario.getEmail());
            TxtSenha.setText(funcionario.getSenha());
            // Exemplo: TxtBairro.setText(funcionario.getEndereco().getBairro());
        }
    }
    
    @FXML
    void trocaFoto(MouseEvent event) {
        // Configurar o FileChooser para filtrar arquivos de imagem
        FileChooser fileChooser = new FileChooser();
        fileChooser.getExtensionFilters().add(new ExtensionFilter("Imagens", "*.jpg", "*.png", "*.jpeg"));

        // Mostrar o diálogo de seleção de arquivo
        File selectedFile = fileChooser.showOpenDialog(new Stage());
        if (selectedFile != null) {
            imgFoto.setImage(new Image(selectedFile.toURI().toString()));     
        }
    }
    
   

    @FXML
    void vol1(MouseEvent event) throws Exception {

    	Main.Cena("TelaPrincipalGerente");
    	
    }

    @FXML
    void EncerrarSessao(MouseEvent event) throws Exception {

    	
    	Connection conecao = ConexãoBD.Conexao();
    	String updateSql ="UPDATE sessao SET sessao = ? WHERE id = 1";
        PreparedStatement updatePs = conecao.prepareStatement(updateSql);
        updatePs.setInt(1, 0);
        int lf = updatePs.executeUpdate();
        
        updatePs.close();
        conecao.close();
        
        Main.Cena("Login");
    	
    	
    	
    }

    @FXML
    void Entrar7(MouseEvent event) {

    	BtnEncerrarSessao.setEffect(efeito.Efeito());
    	
    }

    @FXML
    void RealizarAlteração(MouseEvent event) {

    }

    @FXML
    void Sair7(MouseEvent event) {

    	BtnEncerrarSessao.setEffect(null);
    	
    }
    
    
}