package controller.gerente;


import javafx.fxml.FXML;
import javafx.scene.Node;
import javafx.scene.chart.BarChart;
import javafx.scene.chart.CategoryAxis;
import javafx.scene.chart.NumberAxis;
import javafx.scene.chart.XYChart;
import javafx.scene.image.ImageView;
import javafx.scene.input.MouseEvent;
import javafx.scene.layout.AnchorPane;
import model.LucroMensal;
import model.Produto;
import model.dao.ConexãoBD;
import model.dao.Gerente.GraficoDeLucrosDosMesesDao;
import javafx.scene.paint.Color;


import java.sql.Connection;
import java.sql.SQLException;
import java.util.List;

public class GraficoDeLucrosDosMesesController {

	Color[] coresMeses = {
		    Color.BLUE,
		    Color.RED,
		    Color.GREEN,
		    Color.ORANGE,
		    Color.PURPLE,
		    Color.CYAN,
		    Color.YELLOW,
		    Color.PINK,
		    Color.LIME,
		    Color.BROWN,
		    Color.GRAY,
		    Color.MAGENTA
		    
		};
	
	private String toHex(Color color) {
	    int r = (int) (color.getRed() * 255);
	    int g = (int) (color.getGreen() * 255);
	    int b = (int) (color.getBlue() * 255);
	    return String.format("#%02X%02X%02X", r, g, b);
	}
	
	
    @FXML
    private ImageView BtnImprimir;

    @FXML
    private AnchorPane PainelGrafico;
    
    
    @FXML
    void initialize() {
        // Configurar o gráfico de barras
        CategoryAxis xAxis = new CategoryAxis();
        xAxis.setLabel("Mês");
        NumberAxis yAxis = new NumberAxis();
        yAxis.setLabel("Lucro");
        BarChart<String, Number> barChart = new BarChart<>(xAxis, yAxis);
        barChart.setTitle("");
        barChart.setPrefWidth(1600); 
        barChart.setPrefHeight(600);
        barChart.setBarGap(0); // Defina barGap como 0 para eliminar o espaço entre barras
        barChart.setCategoryGap(10); // Defina categoryGap para ajustar o espaço entre as categorias (meses)
     
     

        try {
        	Connection conexao = ConexãoBD.Conexao();
            GraficoDeLucrosDosMesesDao dao = new GraficoDeLucrosDosMesesDao(conexao);
            List<LucroMensal> lucrosMensais = dao.obterLucrosMensaisDoBanco(2023); 

           
            XYChart.Series<String, Number> series = new XYChart.Series<>();
            for (int i = 0; i < lucrosMensais.size(); i++) {
                LucroMensal lucroMensal = lucrosMensais.get(i);
                String mes = lucroMensal.getMes();
                double lucro = lucroMensal.getLucro();

                // Criar uma série de dados para o mês com uma cor da paleta
                XYChart.Series<String, Number> mesSeries = new XYChart.Series<>();
                mesSeries.getData().add(new XYChart.Data<>(mes, lucro));
                mesSeries.setName(mes); // Definir o nome da série como o mês
                Node node = mesSeries.getNode();
                if (node != null) {
                    node.setStyle("-fx-bar-fill: " + toHex(coresMeses[i]) + ";");
                }

                // Adicionar a série de dados do mês ao gráfico
                barChart.getData().add(mesSeries);
            }
           
            PainelGrafico.getChildren().add(barChart);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    

    @FXML
    void EfeitoImprimir(MouseEvent event) {

    }

    @FXML
    void SairImprimir(MouseEvent event) {

    }

    @FXML
    void imprimir(MouseEvent event) {

    }

    @FXML
    void vol1(MouseEvent event) {

    }

}
